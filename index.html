<!DOCTYPE html>
<html>
  <head>
    <title>Interactive Political Map</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #map {
        height: 85vh;
      }
      #controls {
        height: 15vh;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        background: #f2f2f2;
        border-bottom: 1px solid #ccc;
        padding: 10px;
      }
      .politician-icon {
        border-radius: 50%;
        overflow: hidden;
        border: 2px solid #333;
        transition: transform 0.2s;
      }
      .politician-icon img {
        width: 100%;
        height: 130%;
        object-fit: cover;
        object-position: top center;
      }
      input,
      button {
        padding: 6px 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
      }
      button {
        background: #0077ff;
        color: white;
        border: none;
        cursor: pointer;
      }
      button:hover {
        background: #005bcc;
      }
    </style>
  </head>
  <body>
    <div id="controls">
      <input type="text" id="nameInput" placeholder="نام سیاستمدار" />
      <input type="text" id="imgInput" placeholder="لینک عکس (URL)" />
      <button onclick="addPoliticianFromForm()">➕ اضافه کن</button>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      var map = L.map("map").setView([20, 0], 2);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "© OpenStreetMap contributors",
      }).addTo(map);

      var politicianMarkers = [];

      function createPoliticianIcon(imageUrl, zoomLevel, name) {
        let size = zoomLevel * 6 + 18;
        return L.divIcon({
          html: `<div class="politician-icon" style="width:${size}px;height:${size}px;" title="${name}">
               <img src="${imageUrl}" />
             </div>`,
          className: "",
          iconSize: [size, size],
        });
      }

      function addPolitician(
        lat = 30,
        lng = 50,
        name = "بدون نام",
        imageUrl = "https://upload.wikimedia.org/wikipedia/commons/9/99/Sample_User_Icon.png"
      ) {
        var marker = L.marker([lat, lng], {
          icon: createPoliticianIcon(imageUrl, map.getZoom(), name),
          draggable: true,
        }).addTo(map);

        marker.bindPopup(`<b>${name}</b>`); // نمایش نام در popup
        politicianMarkers.push({
          marker: marker,
          imageUrl: imageUrl,
          name: name,
        });
      }

      // اضافه کردن سیاستمدار از فرم
      function addPoliticianFromForm() {
        let name = document.getElementById("nameInput").value || "بدون نام";
        let img =
          document.getElementById("imgInput").value ||
          "https://upload.wikimedia.org/wikipedia/commons/9/99/Sample_User_Icon.png";
        addPolitician(20, 0, name, img);
        document.getElementById("nameInput").value = "";
        document.getElementById("imgInput").value = "";
      }

      // تغییر اندازه آواتارها با زوم
      map.on("zoom", function () {
        let zoomLevel = map.getZoom();
        politicianMarkers.forEach((p) => {
          p.marker.setIcon(createPoliticianIcon(p.imageUrl, zoomLevel, p.name));
        });
      });
    </script>
    <script>
      // لیست اولیه از سیاستمداران
      var initialPoliticians = [
        {
          name: "Donald Trump",
          lat: 38.9,
          lng: -77.03,
          imageUrl:
            "https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/Official_Presidential_Portrait_of_President_Donald_J._Trump_%282025%29.jpg/250px-Official_Presidential_Portrait_of_President_Donald_J._Trump_%282025%29.jpg",
        },
        {
          name: "Friedrich Merz",
          lat: 52.52,
          lng: 13.4,
          imageUrl:
            "https://upload.wikimedia.org/wikipedia/commons/thumb/0/0b/2024-08-21_Friedrich_Merz_in_Erfurt_2024_STP_3041_by_Stepro_%283x4_cropped%29.jpg/250px-2024-08-21_Friedrich_Merz_in_Erfurt_2024_STP_3041_by_Stepro_%283x4_cropped%29.jpg",
        },
        {
          name: "Xi Jinping",
          lat: 39.9,
          lng: 116.4,
          imageUrl:
            "https://upload.wikimedia.org/wikipedia/commons/thumb/3/37/Xi_Jinping_in_Beijing_on_May_13%2C_2025_%28cropped%29.jpg/250px-Xi_Jinping_in_Beijing_on_May_13%2C_2025_%28cropped%29.jpg",
        },
      ];

      // وقتی نقشه لود شد → سیاستمدارها رو اضافه کن
      initialPoliticians.forEach((p) => {
        addPolitician(p.lat, p.lng, p.name, p.imageUrl);
      });
    </script>
  </body>
</html>
