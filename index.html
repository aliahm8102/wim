<!DOCTYPE html>
<html>
  <head>
    <title>Interactive Political Map</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #map {
        height: 85vh;
      }
      #controls {
        height: 15vh;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        background: #f2f2f2;
        border-bottom: 1px solid #ccc;
        padding: 10px;
      }
      .politician-icon {
        border-radius: 50%;
        overflow: hidden;
        transition: transform 0.2s;
      }
      .politician-icon img {
        width: 100%;
        height: 130%;
        object-fit: cover;
        object-position: top center;
      }
      input,
      button {
        padding: 6px 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
      }
      button {
        background: #0077ff;
        color: white;
        border: none;
        cursor: pointer;
      }
      button:hover {
        background: #005bcc;
      }
    </style>
  </head>
  <body>
    <div id="controls">
      <input type="text" id="nameInput" placeholder="name" />
      <input type="text" id="imgInput" placeholder="image link (URL)" />
      <select id="roleInput">
        <option value="" disabled selected hidden>role</option>
        <option value="member">member</option>
        <option value="leader">leader</option>
      </select>
      <button onclick="addPoliticianFromForm()">➕ add</button>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      var map = L.map("map", {
        maxBounds: [
          [-85, -180],
          [85, 180],
        ],
        maxBoundsViscosity: 1.0,
      }).setView([20, 0], 2);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "© OpenStreetMap contributors",
        noWrap: true,
        minZoom: 3,
      }).addTo(map);

      var politicianMarkers = [];

      // nato countries geojson
      fetch("nato-countries.json")
        .then((response) => response.json())
        .then((data) => {
          L.geoJSON(data, {
            style: {
              fillColor: "blue",
              weight: 2,
              color: "white",
              fillOpacity: 0.5,
            },
            interactive: false,
          }).addTo(map);
        });

      function createPoliticianIcon(
        imageUrl,
        zoomLevel,
        name,
        role = "member"
      ) {
        let size = zoomLevel * 3 + 20;

        // roles options
        let borderColor = role === "leader" ? "gold" : "#333";
        let borderWidth = role === "leader" ? "4px" : "2px";

        return L.divIcon({
          html: `<div class="politician-icon"
                  style="width:${size}px;height:${size}px;
                         border:${borderWidth} solid ${borderColor};"
                  title="${name}">
             <img src="${imageUrl}" />
           </div>`,
          className: "",
          iconSize: [size, size],
        });
      }

      function addPolitician(lat, lng, name, imageUrl, role = "member") {
        var marker = L.marker([lat, lng], {
          icon: createPoliticianIcon(imageUrl, map.getZoom(), name, role),
          draggable: true,
        }).addTo(map);

        marker.bindPopup(`<b>${name}</b> (${role})`);
        politicianMarkers.push({
          marker: marker,
          imageUrl: imageUrl,
          name: name,
          role: role,
        });
      }

      function addPoliticianFromForm() {
        let name = document.getElementById("nameInput").value || "بدون نام";
        let img =
          document.getElementById("imgInput").value ||
          "https://upload.wikimedia.org/wikipedia/commons/9/99/Sample_User_Icon.png";
        let role = document.getElementById("roleInput").value;

        addPolitician(20, 0, name, img, role);

        document.getElementById("nameInput").value = "";
        document.getElementById("imgInput").value = "";
      }

      // zoom Level
      map.on("zoom", function () {
        let zoomLevel = map.getZoom();
        politicianMarkers.forEach((p) => {
          p.marker.setIcon(
            createPoliticianIcon(p.imageUrl, zoomLevel, p.name, p.role)
          );
        });
      });

      // initial Politicians
      var initialPoliticians = [
        {
          name: "Donald Trump",
          lat: 38.9,
          lng: -77.03,
          imageUrl: "img/Donald_Trump.jpg",
          role: "leader",
        },
        {
          name: "Xi Jinping",
          lat: 39.9,
          lng: 116.4,
          imageUrl: "img/Xi_Jinping.jpg",
          role: "leader",
        },
        {
          name: "Abdul-Malik al-Houthi",
          lat: 15.35,
          lng: 44.21,
          imageUrl: "img/Abdul_Malik_al_Houthi.jpg",
          role: "leader",
        },
      ];

      initialPoliticians.forEach((p) => {
        addPolitician(p.lat, p.lng, p.name, p.imageUrl, p.role);
      });
    </script>
    <script>
      fetch("politicians.json")
        .then((response) => response.json())
        .then((data) => {
          data.forEach((p) => {
            addPolitician(p.lat, p.lng, p.name, p.imageUrl, p.role);
          });
        })
        .catch((error) => console.error("خطا در بارگذاری فایل:", error));
    </script>
  </body>
</html>
